# Migration `20190816000411-fix-many-to-many-on-media-and-galleries`

This migration has been generated by Christian de Botton at 8/16/2019, 12:04:11 AM.
You can check out the [state of the datamodel](./datamodel.prisma) after the migration.

## Database Steps

```sql
DROP TABLE "public"."GalleryMedia";

CREATE TABLE "public"."_GalleryToMedia"("A" text   REFERENCES "public"."Gallery"("id") ON DELETE CASCADE,"B" text   REFERENCES "public"."Media"("id") ON DELETE CASCADE)
;

ALTER TABLE "public"."Media" DROP COLUMN "author",ADD COLUMN "author" text   REFERENCES "public"."User"("id") ON DELETE SET NULL;

ALTER TABLE "public"."Gallery" DROP COLUMN "author",ADD COLUMN "author" text   REFERENCES "public"."User"("id") ON DELETE SET NULL;
```

## Changes

```diff
diff --git datamodel.mdl datamodel.mdl
migration 20190815210341-add-etag-to-media..20190816000411-fix-many-to-many-on-media-and-galleries
--- datamodel.dml
+++ datamodel.dml
@@ -17,43 +17,34 @@
   deleted   Boolean   @default(false)
   createdAt DateTime  @default(now())
   updatedAt DateTime  @updatedAt
   lastLogin DateTime?
+  media     Media[]
   galleries Gallery[]
-  media     Media[]
 }
 model Gallery {
-  id          String         @default(cuid()) @unique @id
-  uri         String         @unique
+  id          String   @default(cuid()) @unique @id
+  uri         String   @unique
   title       String
   description String
-  deleted     Boolean        @default(false)
-  publishedAt DateTime       @default(now())
-  createdAt   DateTime       @default(now())
-  updatedAt   DateTime       @updatedAt
-  media       GalleryMedia[]
-  author      User
-}
-
-model GalleryMedia {
-  id          String   @default(cuid()) @unique @id
-  gallery     Gallery
-  media       Media
   deleted     Boolean  @default(false)
   publishedAt DateTime @default(now())
   createdAt   DateTime @default(now())
   updatedAt   DateTime @updatedAt
+  media       Media[]
+  author      User
 }
 model Media {
-  id        String   @default(cuid()) @unique @id
-  author    User
+  id        String    @default(cuid()) @unique @id
   key       String
   etag      String
   bucket    String
   mimetype  String
   encoding  String
-  deleted   Boolean  @default(false)
-  createdAt DateTime @default(now())
-  updatedAt DateTime @updatedAt
+  deleted   Boolean   @default(false)
+  createdAt DateTime  @default(now())
+  updatedAt DateTime  @updatedAt
+  gallery   Gallery[]
+  author    User
 }
```

## Photon Usage

You can use a specific Photon built for this migration (20190816000411-fix-many-to-many-on-media-and-galleries)
in your `before` or `after` migration script like this:

```ts
import Photon from '@generated/photon/20190816000411-fix-many-to-many-on-media-and-galleries'

const photon = new Photon()

async function main() {
  const result = await photon.users()
  console.dir(result, { depth: null })
}

main()

```
