# Migration `20190815201158-update-media-fields`

This migration has been generated by Christian de Botton at 8/15/2019, 8:11:58 PM.
You can check out the [state of the datamodel](./datamodel.prisma) after the migration.

## Database Steps

```sql
ALTER TABLE "public"."Media" DROP COLUMN "filetype",DROP COLUMN "path",ADD COLUMN "filename" text NOT NULL DEFAULT '' ,ADD COLUMN "bucket" text NOT NULL DEFAULT '' ,ADD COLUMN "mimetype" text NOT NULL DEFAULT '' ,ADD COLUMN "encoding" text NOT NULL DEFAULT '' ,DROP COLUMN "author",ADD COLUMN "author" text   REFERENCES "public"."User"("id") ON DELETE SET NULL;

ALTER TABLE "public"."GalleryMedia" DROP COLUMN "gallery",ADD COLUMN "gallery" text   REFERENCES "public"."Gallery"("id") ON DELETE SET NULL,DROP COLUMN "media",ADD COLUMN "media" text   REFERENCES "public"."Media"("id") ON DELETE SET NULL;

ALTER TABLE "public"."Gallery" DROP COLUMN "author",ADD COLUMN "author" text   REFERENCES "public"."User"("id") ON DELETE SET NULL;
```

## Changes

```diff
diff --git datamodel.mdl datamodel.mdl
migration 20190815102548-add-galleries-and-media-to-user..20190815201158-update-media-fields
--- datamodel.dml
+++ datamodel.dml
@@ -47,10 +47,12 @@
 model Media {
   id        String   @default(cuid()) @unique @id
   author    User
+  filename  String
+  bucket    String
+  mimetype  String
+  encoding  String
   deleted   Boolean  @default(false)
-  filetype  String
-  path      String
   createdAt DateTime @default(now())
   updatedAt DateTime @updatedAt
 }
```

## Photon Usage

You can use a specific Photon built for this migration (20190815201158-update-media-fields)
in your `before` or `after` migration script like this:

```ts
import Photon from '@generated/photon/20190815201158-update-media-fields'

const photon = new Photon()

async function main() {
  const result = await photon.users()
  console.dir(result, { depth: null })
}

main()

```
