# Migration `20190814172605-add-media-tables`

This migration has been generated by Christian de Botton at 8/14/2019, 5:26:05 PM.
You can check out the [state of the datamodel](./datamodel.prisma) after the migration.

## Database Steps

```sql
CREATE TABLE "public"."Gallery"("id" text NOT NULL  ,"uri" text NOT NULL DEFAULT '' ,"title" text NOT NULL DEFAULT '' ,"description" text NOT NULL DEFAULT '' ,"deleted" boolean NOT NULL DEFAULT false ,"publishedAt" timestamp(3) NOT NULL  ,"createdAt" timestamp(3) NOT NULL  ,"updatedAt" timestamp(3) NOT NULL DEFAULT '1970-01-01 00:00:00' ,"author" text   REFERENCES "public"."User"("id") ON DELETE SET NULL,PRIMARY KEY ("id"));

CREATE TABLE "public"."GalleryMedia"("id" text NOT NULL  ,"deleted" boolean NOT NULL DEFAULT false ,"publishedAt" timestamp(3) NOT NULL  ,"createdAt" timestamp(3) NOT NULL  ,"updatedAt" timestamp(3) NOT NULL DEFAULT '1970-01-01 00:00:00' ,PRIMARY KEY ("id"));

CREATE TABLE "public"."Media"("id" text NOT NULL  ,"deleted" boolean NOT NULL DEFAULT false ,"filetype" text NOT NULL DEFAULT '' ,"path" text NOT NULL DEFAULT '' ,"createdAt" timestamp(3) NOT NULL  ,"updatedAt" timestamp(3) NOT NULL DEFAULT '1970-01-01 00:00:00' ,"author" text   REFERENCES "public"."User"("id") ON DELETE SET NULL,PRIMARY KEY ("id"));

ALTER TABLE "public"."User" ADD COLUMN "deleted" boolean NOT NULL DEFAULT false ;

ALTER TABLE "public"."Gallery" ADD COLUMN "galleryMedia" text   REFERENCES "public"."GalleryMedia"("id") ON DELETE SET NULL;

ALTER TABLE "public"."GalleryMedia" ADD COLUMN "media" text   REFERENCES "public"."Media"("id") ON DELETE SET NULL;

CREATE UNIQUE INDEX "Gallery.id._UNIQUE" ON "public"."Gallery"("id")

CREATE UNIQUE INDEX "Gallery.uri._UNIQUE" ON "public"."Gallery"("uri")

CREATE UNIQUE INDEX "GalleryMedia.id._UNIQUE" ON "public"."GalleryMedia"("id")

CREATE UNIQUE INDEX "Media.id._UNIQUE" ON "public"."Media"("id")
```

## Changes

```diff
diff --git datamodel.mdl datamodel.mdl
migration 20190809080950-create-users-table..20190814172605-add-media-tables
--- datamodel.dml
+++ datamodel.dml
@@ -1,12 +1,9 @@
 generator photon {
-  provider = "photonjs"
+  provider  = "photonjs"
+  platforms = ["native", "linux-glibc-libssl1.0.1"]
 }
-generator nexus_prisma {
-  provider = "nexus-prisma"
-}
-
 datasource db {
   provider = "postgresql"
   url      = env("POSTGRESQL_URL")
 }
@@ -16,8 +13,41 @@
   email     String    @unique
   password  String
   firstName String?
   lastName  String?
+  deleted   Boolean
   createdAt DateTime  @default(now())
   updatedAt DateTime  @updatedAt
   lastLogin DateTime?
+}
+
+model Gallery {
+  id          String   @default(cuid()) @unique @id
+  uri         String   @unique
+  title       String
+  description String
+  author      User
+  deleted     Boolean
+  publishedAt DateTime @default(now())
+  createdAt   DateTime @default(now())
+  updatedAt   DateTime @updatedAt
+}
+
+model GalleryMedia {
+  id          String   @default(cuid()) @unique @id
+  gallery     Gallery
+  media       Media
+  deleted     Boolean
+  publishedAt DateTime @default(now())
+  createdAt   DateTime @default(now())
+  updatedAt   DateTime @updatedAt
+}
+
+model Media {
+  id        String   @default(cuid()) @unique @id
+  author    User
+  deleted   Boolean
+  filetype  String
+  path      String
+  createdAt DateTime @default(now())
+  updatedAt DateTime @updatedAt
 }
```

## Photon Usage

You can use a specific Photon built for this migration (20190814172605-add-media-tables)
in your `before` or `after` migration script like this:

```ts
import Photon from '@generated/photon/20190814172605-add-media-tables'

const photon = new Photon()

async function main() {
  const result = await photon.users()
  console.dir(result, { depth: null })
}

main()

```
